"use strict";(self.webpackChunkdronahq_docs=self.webpackChunkdronahq_docs||[]).push([[19559],{40895:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>p,metadata:()=>d,toc:()=>u});n(67294);var a=n(3905),i=n(86291);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const p={sidebar_position:1,title:"Using JavaScript to Handle JWT Token Expiry"},s=void 0,d={unversionedId:"app-scripting-and-code/javascript-jwt-token-expiry",id:"app-scripting-and-code/javascript-jwt-token-expiry",title:"Using JavaScript to Handle JWT Token Expiry",description:"We're familiar with utilizing various authentication methods like OAuth 2.0 and API keys for REST API access. However,",source:"@site/docs/app-scripting-and-code/javascript-jwt-token-expiry.md",sourceDirName:"app-scripting-and-code",slug:"/app-scripting-and-code/javascript-jwt-token-expiry",permalink:"/app-scripting-and-code/javascript-jwt-token-expiry",draft:!1,tags:[],version:"current",lastUpdatedAt:1714985761,formattedLastUpdatedAt:"May 6, 2024",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Using JavaScript to Handle JWT Token Expiry"},sidebar:"docSidebar",previous:{title:"Trigger Data Queries using JavaScript",permalink:"/app-scripting-and-code/dataquery-trigger-method"},next:{title:"JS transformation",permalink:"/app-scripting-and-code/js-transformation"}},c={},u=[{value:"REST API Connector Configuration",id:"rest-api-connector-configuration",level:2},{value:"Retrieving Data from a REST API and Displaying it in a TableGrid",id:"retrieving-data-from-a-rest-api-and-displaying-it-in-a-tablegrid",level:2}],k={toc:u},m="wrapper";function h(e){var{components:t}=e,n=l(e,["components"]);return(0,a.kt)(m,o(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){r(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"We're familiar with utilizing various authentication methods like OAuth 2.0 and API keys for REST API access. However,\nthis article focuses on implementing JWT Token Authentication."),(0,a.kt)("p",null,"In this scenario, we send a resource request to the Data Endpoint using a stored JWT Token. Should the token expire or\nbecome invalid, the request fails. To address this, we refresh the token by obtaining a new one from the Login Endpoint.\nSubsequently, the requested data is bound to the TableGrid Control."),(0,a.kt)("p",null,"This tutorial exclusively employs Xano's API endpoints. Additionally, note that the JWT Token we're utilizing has an\nexpiry after 60 seconds."),(0,a.kt)("h2",{id:"rest-api-connector-configuration"},"REST API Connector Configuration"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Set the Authentication to ",(0,a.kt)("inlineCode",{parentName:"li"},"None")),(0,a.kt)("li",{parentName:"ol"},"Copy the ",(0,a.kt)("inlineCode",{parentName:"li"},"/auth/login")," endpoint from Xano and paste it in the connector\u2019s url section and set the http method to\n",(0,a.kt)("inlineCode",{parentName:"li"},"POST"),"."),(0,a.kt)("li",{parentName:"ol"},"Pass Raw JSON containing the ",(0,a.kt)("inlineCode",{parentName:"li"},"valid user credentials")," to receive the JWT Token.")),(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-api.png",alt:"Adding API details.",mdxType:"Thumbnail"}),(0,a.kt)("figcaption",{align:"center"},(0,a.kt)("i",null,"Adding API details."))),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"Now add one more API to this connector, this will request data from Xano\u2019s resource endpoint."),(0,a.kt)("li",{parentName:"ol"},"Add a new header ",(0,a.kt)("inlineCode",{parentName:"li"},"Authorization")," which will take the JWT Token as input.")),(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-query.png",alt:"Adding API endpoint",mdxType:"Thumbnail"}),(0,a.kt)("figcaption",{align:"center"},(0,a.kt)("i",null,"Adding API endpoint"))),(0,a.kt)("h2",{id:"retrieving-data-from-a-rest-api-and-displaying-it-in-a-tablegrid"},"Retrieving Data from a REST API and Displaying it in a TableGrid"),(0,a.kt)("p",null,"For this use case, we will use the ",(0,a.kt)("inlineCode",{parentName:"p"},"Screen Open Action")," to trigger data retrieval from the REST API. To display the data\naccessed from the REST API, we are using the TableGrid Control."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Variable Creation: from the data query section create a new Persistent variable named ",(0,a.kt)("inlineCode",{parentName:"p"},"authToken")," to store the JWT\ntoken. Leave the default value field blank. "),(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-variable.jpeg",alt:"variable",mdxType:"Thumbnail"}))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"REST API Connector:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Select the appropriate REST API Connector to retrieve data from the Xano endpoint."),(0,a.kt)("li",{parentName:"ul"},"Within the connector's Authorization field, specify the ",(0,a.kt)("inlineCode",{parentName:"li"},"authToken")," variable."),(0,a.kt)("li",{parentName:"ul"},"Introduce a new output variable named ",(0,a.kt)("inlineCode",{parentName:"li"},"data")," to hold the response received from the REST API.",(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-connector.png",alt:"variable",mdxType:"Thumbnail"})))))),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Binding Data to TableGrid:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Upon successful retrieval by the REST API, incorporate a ",(0,a.kt)("inlineCode",{parentName:"li"},"Set Control Value")," Action within the success branch. This\naction will bind the fetched data (",(0,a.kt)("inlineCode",{parentName:"li"},"data")," variable) to the TableGrid control, enabling its display.",(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-setctrl.png",alt:"variable",mdxType:"Thumbnail"}))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Error Handling (Expired Token):"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"If the ",(0,a.kt)("inlineCode",{parentName:"li"},"authToken")," variable holds an expired or invalid token, the REST API will respond with a 401 status code. To\naddress this, add another REST API Connector configured to request a new JWT token from Xano's login endpoint."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"New Token Storage:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Create a variable (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"newAuthToken"),") to store the newly acquired authentication token received in the API\nresponse."),(0,a.kt)("li",{parentName:"ul"},"Ensure you select ",(0,a.kt)("inlineCode",{parentName:"li"},"output.authToken")," during variable assignment. This step de-structures the response and extracts\nonly the ",(0,a.kt)("inlineCode",{parentName:"li"},"authToken")," value.",(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-authtoken.png",alt:"variable",mdxType:"Thumbnail"}))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Updating Auth Token:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Assign the newly acquired token (stored in ",(0,a.kt)("inlineCode",{parentName:"li"},"newAuthToken"),") to the previously created ",(0,a.kt)("inlineCode",{parentName:"li"},"authToken")," variable.",(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-setauthtoken.png",alt:"variable",mdxType:"Thumbnail"}))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Repeating Steps:"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Repeat steps 2, 3, and 4 to utilize the updated ",(0,a.kt)("inlineCode",{parentName:"li"},"authToken")," for subsequent data retrieval.")))),(0,a.kt)("p",null,"Verification:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Following these steps, your App's Action Flow should resemble the provided image.",(0,a.kt)("figure",null,(0,a.kt)(i.Z,{src:"/img/app-scripting-and-code/javascript-jwt-token-expiry/javascript-jwt-token-expiry-flow.png",alt:"variable",mdxType:"Thumbnail"}))),(0,a.kt)("li",{parentName:"ul"},"Run the App to observe the automatic loading of API data within the TableGrid control.")))}h.isMDXComponent=!0}}]);