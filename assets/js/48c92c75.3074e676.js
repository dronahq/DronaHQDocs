"use strict";(self.webpackChunkdronahq_docs=self.webpackChunkdronahq_docs||[]).push([[19307],{95678:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(67294);const i={"main-img":"main-img_qxSY"};function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const l=e=>{var{src:t}=e,l=s(e,["src"]);const[c,u]=(0,r.useState)(!1),p=n(2181)(`./static${t}`).default;return r.createElement("div",{className:i.thumbnail},r.createElement("img",a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({src:p},l),{className:`${i["main-img"]} ${l.className||""}`})))}},76101:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>c,default:()=>b,frontMatter:()=>l,metadata:()=>u,toc:()=>f});n(67294);var r=n(3905),i=n(95678);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const l={sidebar_position:154,title:"Configuring AWS S3"},c=void 0,u={unversionedId:"file-storage/Configure-aws-s3",id:"file-storage/Configure-aws-s3",title:"Configuring AWS S3",description:"This guide provides step-by-step instructions to configure an AWS S3 bucket access policy in selfhosted, ensuring secure and controlled access to your files by whitelisting specific domains.",source:"@site/docs/file-storage/Configure-aws-s3.md",sourceDirName:"file-storage",slug:"/file-storage/Configure-aws-s3",permalink:"/file-storage/Configure-aws-s3",draft:!1,tags:[],version:"current",lastUpdatedAt:1727073705,formattedLastUpdatedAt:"Sep 23, 2024",sidebarPosition:154,frontMatter:{sidebar_position:154,title:"Configuring AWS S3"},sidebar:"docSidebar",previous:{title:"Upload Files",permalink:"/file-storage/data-queries/uploadfile"},next:{title:"Configure AWS policy for DronaHQ Managed Storage",permalink:"/file-storage/configure-aws-policy-for-dronahq-managed-storage"}},p={},f=[{value:"Step-by-Step Guide",id:"step-by-step-guide",level:2},{value:"1. Login to AWS:",id:"1-login-to-aws",level:3},{value:"2. Navigate to Amazon S3:",id:"2-navigate-to-amazon-s3",level:3},{value:"3. Select the S3 Bucket",id:"3-select-the-s3-bucket",level:3},{value:"4. Edit Permissions:",id:"4-edit-permissions",level:3},{value:"5. Edit the Bucket Policy",id:"5-edit-the-bucket-policy",level:3}],d={toc:f},m="wrapper";function b(e){var{components:t}=e,n=s(e,["components"]);return(0,r.kt)(m,a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({},d,n),{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This guide provides step-by-step instructions to configure an AWS S3 bucket access policy in selfhosted, ensuring secure and controlled access to your files by whitelisting specific domains."),(0,r.kt)("h2",{id:"step-by-step-guide"},"Step-by-Step Guide"),(0,r.kt)("h3",{id:"1-login-to-aws"},"1. Login to AWS:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Access the AWS Console and sign in.")),(0,r.kt)("h3",{id:"2-navigate-to-amazon-s3"},"2. Navigate to Amazon S3:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Navigate to S3 from Services.")),(0,r.kt)("h3",{id:"3-select-the-s3-bucket"},"3. Select the S3 Bucket"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the Amazon S3 console, locate and select the bucket you want to configure access policies for.")),(0,r.kt)("h3",{id:"4-edit-permissions"},"4. Edit Permissions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the Permissions tab, disable Block all public access.")),(0,r.kt)("h3",{id:"5-edit-the-bucket-policy"},"5. Edit the Bucket Policy"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Add a policy that includes the ",(0,r.kt)("inlineCode",{parentName:"p"},"aws:Referer")," condition to whitelist specific domains. Below is an example policy for reference:"),(0,r.kt)("figure",null,(0,r.kt)(i.Z,{src:"/img/access-policy-file-storage/bucket_policy.png",alt:"Bucket Policy",mdxType:"Image"})),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Version": "2012-11-04",\n    "Id": "example referer policy",\n    "Statement": [\n        {\n            "Sid": "AllowGetRequestsForSpecificDomains",\n            "Effect": "Allow",\n            "Principal": "*",\n            "Action": "s3:GetObject",\n            "Resource": "arn:aws:s3:::<your-bucket-name>/*",\n            "Condition": {\n                "StringLike": {\n                    "aws:Referer": [\n                        "https://<your-domain-name>.com/*",\n                        "https://<your-subdomain-name>.com/*"\n                    ]\n                }\n            }\n        }\n    ]\n}\n\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Here, the ",(0,r.kt)("inlineCode",{parentName:"p"},"s3:GetObject")," operation will only be allowed if the request originates from the specified referrers. This ensures that only approved domains can access the bucket's contents. Note that there is no expiration for these domains; they will remain whitelisted as long as they are included in the policy."))),(0,r.kt)("admonition",{title:"PLEASE NOTE",type:"info"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Policy Version"),": Ensure the policy version is correct. The example uses ",(0,r.kt)("inlineCode",{parentName:"li"},'"Version": "2012-11-04"'),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Resource ARN"),": Replace ",(0,r.kt)("inlineCode",{parentName:"li"},"${bucketName}")," with your actual S3 bucket name. The ARN format should be ",(0,r.kt)("inlineCode",{parentName:"li"},"arn:aws:s3:::<your-bucket-name>/*"),"."))))}b.isMDXComponent=!0}}]);