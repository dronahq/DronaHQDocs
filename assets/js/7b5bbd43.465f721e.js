"use strict";(self.webpackChunkdronahq_docs=self.webpackChunkdronahq_docs||[]).push([[38957],{45438:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>u,contentTitle:()=>d,default:()=>k,frontMatter:()=>s,metadata:()=>p,toc:()=>m});a(67294);var n=a(3905),i=a(86291);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function l(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}(Object(e)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))})),t}function o(t,e){if(null==t)return{};var a,n,i=function(t,e){if(null==t)return{};var a,n,i={},r=Object.keys(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||(i[a]=t[a]);return i}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)a=r[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(i[a]=t[a])}return i}const s={sidebar_position:1},d="Configure AD FS",p={unversionedId:"sso-guides/configure-adfs-saml",id:"sso-guides/configure-adfs-saml",title:"Configure AD FS",description:"Prerequisites",source:"@site/docs/sso-guides/configure-adfs-saml.md",sourceDirName:"sso-guides",slug:"/sso-guides/configure-adfs-saml",permalink:"/sso-guides/configure-adfs-saml",draft:!1,tags:[],version:"current",lastUpdatedAt:1723050861,formattedLastUpdatedAt:"Aug 7, 2024",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"docSidebar",previous:{title:"SSO guides",permalink:"/category/sso-guides"},next:{title:"Configure Auth0 OIDC SSO",permalink:"/sso-guides/configure-auth0-oidc"}},u={},m=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a Relying party Trust in ADFS",id:"creating-a-relying-party-trust-in-adfs",level:2},{value:"Create rule to Send LDAP attributes as claims",id:"create-rule-to-send-ldap-attributes-as-claims",level:2},{value:"Configure in DronaHQ",id:"configure-in-dronahq",level:2},{value:"ADFS SAML in Action",id:"adfs-saml-in-action",level:2}],c={toc:m},g="wrapper";function k(t){var{components:e}=t,a=o(t,["components"]);return(0,n.kt)(g,l(function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter((function(t){return Object.getOwnPropertyDescriptor(a,t).enumerable})))),n.forEach((function(e){r(t,e,a[e])}))}return t}({},c,a),{components:e,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"configure-ad-fs"},"Configure AD FS"),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"To set up Active Directory Federation Services (AD FS) SSO in DronaHQ, you will need:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Access permissions to create a relying party trust in your ADFS settings."),(0,n.kt)("li",{parentName:"ol"},"Manage Users access on self-hosted DronaHQ instance or DronaHQ Cloud to configure SSO configurations.")),(0,n.kt)("h2",{id:"creating-a-relying-party-trust-in-adfs"},"Creating a Relying party Trust in ADFS"),(0,n.kt)("p",null,"Follow the ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/operations/create-a-relying-party-trust#to-create-a-claims-aware-relying-party-trust-manually"},"Relying Party Trust wizard")," in Active Directory with the following settings."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"In ",(0,n.kt)("inlineCode",{parentName:"li"},"Select Data Source"),", select ",(0,n.kt)("inlineCode",{parentName:"li"},"Enter data about the relying party manually"),"."),(0,n.kt)("li",{parentName:"ol"},"In ",(0,n.kt)("inlineCode",{parentName:"li"},"Choose Profile"),", select ",(0,n.kt)("inlineCode",{parentName:"li"},"AD FS profile"),"."),(0,n.kt)("li",{parentName:"ol"},"In ",(0,n.kt)("inlineCode",{parentName:"li"},"Configure Certificate"),", do not upload a certificate."),(0,n.kt)("li",{parentName:"ol"},"In ",(0,n.kt)("inlineCode",{parentName:"li"},"Configure URL"),", select ",(0,n.kt)("inlineCode",{parentName:"li"},"Enable support for SAML 2.0 WebSSO Protocol"),". Download and Open DronaHQ metadata file. To locate this file, Go to ",(0,n.kt)("inlineCode",{parentName:"li"},"DronaHQ -> Manage Users -> SSO CONFIGURATION -> + Add SSO -> SAML 2.0"),", Under Entity ID and Metadata URL open this url file. Configure URL is the location where SAML assertion is sent with an ",(0,n.kt)("inlineCode",{parentName:"li"},"HTTP POST"),", known as ",(0,n.kt)("inlineCode",{parentName:"li"},"SAML Assertion Consumer Service URL"),". Locate this in the Metadata downloaded and paste it here. Ex - ",(0,n.kt)("a",{parentName:"li",href:"https://studio.dronahq.com/callback/saml"},"https://studio.dronahq.com/callback/saml"),"."),(0,n.kt)("li",{parentName:"ol"},"In ",(0,n.kt)("inlineCode",{parentName:"li"},"Configure Identifiers"),", add your single-sign on domain without the protocol as a ",(0,n.kt)("inlineCode",{parentName:"li"},"Relying party trust identifier"),". For example, use ",(0,n.kt)("inlineCode",{parentName:"li"},"dronahq.yourcompany.com")," instead of ",(0,n.kt)("inlineCode",{parentName:"li"},"https://dronahq.yourcompany.com"),".\nFinish the wizard.")),(0,n.kt)("h2",{id:"create-rule-to-send-ldap-attributes-as-claims"},"Create rule to Send LDAP attributes as claims"),(0,n.kt)("p",null,"Follow the steps to ",(0,n.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows-server/identity/ad-fs/operations/create-a-rule-to-send-ldap-attributes-as-claims"},"send LDAP attributes as claims"),"."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"On the ",(0,n.kt)("inlineCode",{parentName:"li"},"Choose rule type")," page, select ",(0,n.kt)("inlineCode",{parentName:"li"},"Send LDAP Attributes as Claims"),"."),(0,n.kt)("li",{parentName:"ol"},"On the ",(0,n.kt)("inlineCode",{parentName:"li"},"Configure claim rule")," page, choose ",(0,n.kt)("inlineCode",{parentName:"li"},"Active Directory")," as the attribute store. Fill in the following settings.")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"LDAP Attribute"),(0,n.kt)("th",{parentName:"tr",align:null},"Outgoing Claim Type"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Email addresses"),(0,n.kt)("td",{parentName:"tr",align:null},"email")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Email addresses"),(0,n.kt)("td",{parentName:"tr",align:null},"AD FS 1.x Email address")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Given Name"),(0,n.kt)("td",{parentName:"tr",align:null},"name")))),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},"Select ",(0,n.kt)("inlineCode",{parentName:"li"},"Transform an Incoming Claim")," and select the following settings.")),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Setting"),(0,n.kt)("th",{parentName:"tr",align:null},"Value"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Incoming claim type"),(0,n.kt)("td",{parentName:"tr",align:null},"AD FS 1.x Email Address")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Outgoing claim type"),(0,n.kt)("td",{parentName:"tr",align:null},"Name ID")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Outgoing claim ID format"),(0,n.kt)("td",{parentName:"tr",align:null},"Email")))),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Select Pass through all claim values and save the settings.")),(0,n.kt)("h2",{id:"configure-in-dronahq"},"Configure in DronaHQ"),(0,n.kt)("p",null,"In order to configure SAML in DronaHQ, we will need metadata file from your IDP. There is usually a button to download this from your IdP dashboard. Additionally, you can often find this by navigating to ",(0,n.kt)("a",{parentName:"p",href:"https://your.identityprovider.com/federationmetadata/2007-06/federationmetadata.xml"},"https://your.identityprovider.com/federationmetadata/2007-06/federationmetadata.xml"),"."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Now that we have metadata file, In DronaHQ, Go to ",(0,n.kt)("inlineCode",{parentName:"li"},"Manage Users -> SSO Configuration -> + ADD SSO -> SAML 2.0"))),(0,n.kt)("p",null,"Enter form with below fields -"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Field"),(0,n.kt)("th",{parentName:"tr",align:null},"Description"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Name"),(0,n.kt)("td",{parentName:"tr",align:null},"Provide Friendly Name of this SSO configuration")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Entity ID"),(0,n.kt)("td",{parentName:"tr",align:null},"The entity ID is present in metadata file. Copy the ID and paste it.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Login URL / SSO URL"),(0,n.kt)("td",{parentName:"tr",align:null},"Enter the details of location of ",(0,n.kt)("inlineCode",{parentName:"td"},"singlesignonservice")," from metadata file for POST method.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"X509 public certificate"),(0,n.kt)("td",{parentName:"tr",align:null},"X509Certificate file in ",(0,n.kt)("inlineCode",{parentName:"td"},".cer")," format. This file you can create following this ",(0,n.kt)("a",{parentName:"td",href:"/sso/configuring-sso-with-saml#creating-x509-public-certificate"},"step")," whose content you can locate in the metadata file.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Binding type"),(0,n.kt)("td",{parentName:"tr",align:null},"Enter ",(0,n.kt)("inlineCode",{parentName:"td"},"HTTP POST"),".")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Restricted Domain"),(0,n.kt)("td",{parentName:"tr",align:null},"Enter domain name for which you want your users to login with for this SSO Configuration. You can add multiple domain names as well. eg - ",(0,n.kt)("inlineCode",{parentName:"td"},"domain1.com , domain2.com"),". DronaHQ will automatically redirect to SSO url when we encounter any user\u2019s sign in request with an email id belonging to the given restricted domain.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Want Auth request signed"),(0,n.kt)("td",{parentName:"tr",align:null},"Locate this your IDP metadata file. Usually, Keep this default setting as ",(0,n.kt)("inlineCode",{parentName:"td"},"False"),".")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Add Claim List"),(0,n.kt)("td",{parentName:"tr",align:null},"We have already assigned Email and Name in ADFS. We will now enter same key name - ",(0,n.kt)("inlineCode",{parentName:"td"},"email")," and ",(0,n.kt)("inlineCode",{parentName:"td"},"name")," and map it to ",(0,n.kt)("inlineCode",{parentName:"td"},"DHQ User Name")," and ",(0,n.kt)("inlineCode",{parentName:"td"},"DHQ User Email")," respectively.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Enable JIT user provisioning"),(0,n.kt)("td",{parentName:"tr",align:null},"Toggle this ",(0,n.kt)("inlineCode",{parentName:"td"},"ON")," so that you won\u2019t have to manually invite each user to DronaHQ first.")),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Enable SCIM User Provisioning"),(0,n.kt)("td",{parentName:"tr",align:null},"Enable this in case you want to create, update and deactivate User accounts at your IDP portal and sync it with DronaHQ user management.")))),(0,n.kt)("ol",{start:2},(0,n.kt)("li",{parentName:"ol"},"Save the draft. Again navigate back to the SSO configuration option. You can see the newly created SAML.")),(0,n.kt)("figure",null,(0,n.kt)(i.Z,{src:"/img/sso/guides/sso-dronahq-okta-saml-draft.png",alt:"SAML in Draft state",mdxType:"Thumbnail"}),(0,n.kt)("figcaption",{align:"center"},(0,n.kt)("i",null,"SAML in Draft state"))),(0,n.kt)("ol",{start:3},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"You can click on ",(0,n.kt)("inlineCode",{parentName:"p"},"Test SSO")," button and it will open SSO Login url in a popup window.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Once you login successfully and if everything is set up correctly, then finally you will see a success message at the bottom."))),(0,n.kt)("figure",null,(0,n.kt)(i.Z,{src:"/img/sso/guides/sso-dronahq-okta-oauth-success.png",alt:"SAML Signin Success",mdxType:"Thumbnail"}),(0,n.kt)("figcaption",{align:"center"},(0,n.kt)("i",null,"SAML Signin Success"))),(0,n.kt)("ol",{start:5},(0,n.kt)("li",{parentName:"ol"},"Now, that testing is successful, you can click on the more option for above SSO configuration and click on ",(0,n.kt)("inlineCode",{parentName:"li"},"Activate")," to make it live.")),(0,n.kt)("figure",null,(0,n.kt)(i.Z,{src:"/img/sso/guides/sso-dronahq-okta-saml-active.png",alt:"SAML SSO Active",mdxType:"Thumbnail"}),(0,n.kt)("figcaption",{align:"center"},(0,n.kt)("i",null,"SAML SSO Active"))),(0,n.kt)("h2",{id:"adfs-saml-in-action"},"ADFS SAML in Action"),(0,n.kt)("p",null,"Now, since our ADFS SAML SSO is live, we check in either DronaHQ End user portal - ",(0,n.kt)("a",{parentName:"p",href:"https://web.dronahq.io"},"Web"),", ",(0,n.kt)("a",{parentName:"p",href:"https://play.google.com/store/apps/details?id=com.drona5"},"Android")," or ",(0,n.kt)("a",{parentName:"p",href:"https://apps.apple.com/us/app/dronahq/id905354460"},"iOS")," and see our configured adfs saml sso in action."),(0,n.kt)("p",null,"Simply go to DronaHQ End user webapp and enter your email id with domain that matches the configured restricted domain specified in SSO configuration and Click ",(0,n.kt)("inlineCode",{parentName:"p"},"Continue"),"."),(0,n.kt)("figure",null,(0,n.kt)(i.Z,{src:"/img/sso/guides/sso-dronahq-okta-saml-webapp.png",alt:"SAML in WebApp",mdxType:"Thumbnail"}),(0,n.kt)("figcaption",{align:"center"},(0,n.kt)("i",null,"SAML in WebApp"))),(0,n.kt)("p",null,"Instead of asking for password, it asks for Login via SAML SSO provider. Click on it and open a popup window of your idp and the user can login with your idp login credentials."),(0,n.kt)("p",null,"Go to ",(0,n.kt)("inlineCode",{parentName:"p"},"Manage User")," section on DronaHQ and you will see the new user created since ",(0,n.kt)("inlineCode",{parentName:"p"},"JIT")," was enabled."))}k.isMDXComponent=!0}}]);